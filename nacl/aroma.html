<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>hi</title>
  <style type="text/css">
    embed {
      border: 1px solid black;
    }

    textarea {
      width: 400px;
      height: 200px;
    }

    body {
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <button id="send">Send messages</button>
  <div id="listener">
    <embed name="nacl_module"
      id="aroma"
      width=300 height=300
      src="aroma.nmf"
      type="application/x-nacl" />
  </div>
  <pre id="output"></pre>
  <div class="loading">Loading...</div>

  <script type="text/javascript">
    $ = function(name) { return document.getElementById(name); }
    A = function(thing) { return Array.prototype.slice.apply(thing) };

    module = null;
    (function() {
      var output = $("output");

      var listener = $("listener");
      listener.addEventListener("load", function() {
          console.log("module loaded..");
          module = $('aroma');
          A(document.querySelectorAll(".loading")).map(function(node) {
            node.style.display = "none";
          });
      }, true);

      listener.addEventListener("message", function(e) {
        output.innerHTML += e.data + " :: " + typeof(e.data) + "\n";
      }, true);

      $("send").onclick = function() {
        module.postMessage(null);
        module.postMessage("hello");
        module.postMessage(3434);
        module.postMessage(3434.343);
        module.postMessage(false);
      };

    })();

  </script>
</body>
</html>
